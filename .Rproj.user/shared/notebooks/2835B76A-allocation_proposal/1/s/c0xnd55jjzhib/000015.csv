"0","nat <- pin %>% 
  mutate(state = recode(state, 
                        ""Bago (East)"" = ""Bago"", 
                        ""Bago (West)"" = ""Bago"", 
                        ""Shan (North)"" = ""Shan"", 
                        ""Shan (East)"" = ""Shan"", 
                        ""Shan (South)"" = ""Shan"")) %>% 
  left_join(states %>%
              mutate(
                population = pc / 100 * 53431391.27,
                moderately_insecure = moderately_insecure / 100 * population,
                severely_insecure = severely_insecure / 100 * population,
                PIN = (moderately_insecure + severely_insecure),
                `%_PIN` = round(PIN / sum(PIN, na.rm = TRUE) * 100,
                                digits = 2),
                insecure = moderately_insecure + severely_insecure
              ) %>%
              mutate_at(vars(moderately_insecure,
                             severely_insecure,
                             insecure),
                        ~ round(.x)) %>%
              arrange(desc(insecure)) %>% 
              select(state, 
                     state_moderate = moderately_insecure, 
                     state_severe = severely_insecure, 
                     state_insecure = insecure), 
            by = ""state"") %>% 
  mutate_at(vars(conflict_score, mdp_adjust), 
            ~ range_wna(.x)) %>% 
  mutate(conflict_affected = conflict_score * population_2021_proj, 
         vulnerable = mdp_adjust * population_2021_proj) %>%
  replace_na(list(conflict_score = 0, vulnerable = 0))  %>% 
  group_by(state) %>% 
  mutate(caseload = pmax(conflict_affected, vulnerable), 
         # this is where the township calculations come into play
         pc_caseload = caseload / sum(caseload),
         pc_pop = population/ sum(population),
         tsp_moderate = state_moderate * pc_pop,
         tsp_severe = state_severe * pc_pop, 
         tsp_pin = state_insecure * pc_caseload) %>% 
  select(state, township, admin3_pcode, 
         population = population_2021_proj, 
         conflict_score, mdp_adjust, 
         conflict_affected, 
         vulnerable, 
         caseload, 
         tsp_moderate, 
         tsp_severe, 
         tsp_pin) %>% 
  ungroup()
"
"2","Error: Problem with `mutate()` column `pc_pop`.
[34mi[39m `pc_pop = population/sum(population)`.
[31mx[39m only defined on a data frame with all numeric-alike variables
[34mi[39m The error occurred in group 1: state = ""Ayeyarwady"".
[90mRun `rlang::last_error()` to see where the error occurred.[39m
"
