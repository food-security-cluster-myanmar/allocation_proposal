"0","states <- msna %>%"
"0","  mutate("
"0","    state = str_replace_all(state, ""_"", "" ""),"
"0","    state = str_remove_all(state, ""east|west|north|south""),"
"0","    state = str_trim(state),"
"0","    state = str_to_title(state)) %>%"
"0","  mutate(status = case_when("
"0","    fs_calculated_fcs <= 21 ~ ""poor"","
"0","    fs_calculated_fcs >= 21.5 & fs_calculated_fcs <= 35 ~ ""borderline"","
"0","    fs_calculated_fcs > 35 ~ ""acceptable"")) %>% "
"0","  group_by(state, status) %>% "
"0","  summarise(weight = sum(weights, na.rm = TRUE), "
"0","            .groups = ""drop"") %>% "
"0","  mutate(state = str_replace_all(state, ""_"", "" ""),"
"0","    state = str_remove_all(state, ""east|west|north|south""),"
"0","    state = str_trim(state),"
"0","    state = str_to_title(state)) %>%"
"0","  left_join(survey %>% "
"0","              mutate(fcs_status = case_when("
"0","                hhfcs <= 21 ~ ""poor"","
"0","                hhfcs >= 21.5 & hhfcs <= 35 ~ ""borderline"","
"0","                hhfcs > 35 ~ ""acceptable""), "
"0","                rcsi_status = ifelse(rcsi >= 4, "
"0","                                     ""marginal"", ""secure"")) %>% "
"0","              group_by(adm_name, fcs_status, rcsi_status) %>%"
"0","              summarise(weights = sum(weight_final), "
"0","                        .groups = ""drop"") %>% "
"0","              mutate(pc = weights / sum(weights)) %>% "
"0","              group_by(state = adm_name) %>% "
"0","              mutate(state_weight = sum(weights), "
"0","                     state_pc = weights / state_weight) %>% "
"0","              ungroup(), "
"0","            by = ""state"") %>% "
"0","  distinct(state,"
"0","           weight, "
"0","           fcs_status, "
"0","           rcsi_status, "
"0","           weights, "
"0","           pc, "
"0","           state_weight, "
"0","           state_pc) %>% "
"0","  mutate(rcsi_status = ifelse(fcs_status == ""acceptable"", "
"0","                              rcsi_status, NA_character_)) %>% "
"0","  group_by(state, fcs_status, rcsi_status) %>% "
"0","  summarise(weights = sum(weights)) %>% "
"0","  mutate(domain = case_when("
"0","      fcs_status == ""poor"" ~ ""severely_insecure"","
"0","      fcs_status == ""borderline"" ~ ""moderately_insecure"","
"0","      fcs_status == ""acceptable"" & rcsi_status == ""marginal"" ~ ""marginally_secure"","
"0","      fcs_status == ""acceptable"" & rcsi_status == ""secure"" ~ ""secure"")) %>% "
"0","  group_by(state, domain) %>% "
"0","  summarise(final_weight = sum(weights), "
"0","            .groups = ""drop"") %>% "
"0","  group_by(state) %>%"
"0","  mutate(state_pc = round(final_weight / sum(final_weight) * 100,"
"0","                          digits = 2)) %>% "
"0","  ungroup() %>%"
"0","  mutate(pc = round(final_weight / sum(final_weight, na.rm = TRUE) * 100,"
"0","                    digits = 2))  %>%"
"0","  left_join(pin %>% "
"0","              mutate(state = recode(state, "
"0","                        ""Bago (East)"" = ""Bago"", "
"0","                        ""Bago (West)"" = ""Bago"", "
"0","                        ""Shan (North)"" = ""Shan"", "
"0","                        ""Shan (East)"" = ""Shan"", "
"0","                        ""Shan (South)"" = ""Shan"")) %>% "
"0","              group_by(state) %>% "
"0","              summarise(population = sum(population_2021_proj)))  "
"2","`summarise()` has grouped output by 'state', 'fcs_status'. You can override using the `.groups` argument.
"
"2","Joining, by = ""state""
"
"0"," "
