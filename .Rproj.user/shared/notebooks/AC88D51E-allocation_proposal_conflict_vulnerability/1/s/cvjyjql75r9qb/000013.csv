"0","nat <- pin %>% "
"0","  mutate(state = recode(state, "
"0","                        ""Bago (East)"" = ""Bago"", "
"0","                        ""Bago (West)"" = ""Bago"", "
"0","                        ""Shan (North)"" = ""Shan"", "
"0","                        ""Shan (East)"" = ""Shan"", "
"0","                        ""Shan (South)"" = ""Shan"")) %>%"
"0","  left_join(idps %>% "
"0","              select(admin3_pcode = township_pcode, "
"0","                     IDPs = id_ps, "
"0","                     population), "
"0","            by = ""admin3_pcode"") %>% "
"0","  left_join(r4 %>% select(state, "
"0","                          insecure_pc, "
"0","                          insecure_persons), "
"0","            by = ""state"")  %>% "
"0","  select(state, township, "
"0","         vul_score = mdp_adjust, "
"0","         conflict_score, "
"0","         insecure_pc, insecure_persons, "
"0","         IDPs, "
"0","         population, "
"0","         admin3_pcode) %>% "
"0","  mutate(population = ifelse(township == ""Hlaingtharya"", "
"0","                                 819886, population)) %>% "
"0","  replace_na(list(IDPs = 0)) %>% "
"0","  mutate_at(vars(insecure_pc),"
"0","            ~ as.double(str_remove_all(.x, ""\\%""))) %>% "
"0","  mutate_at(vars(conflict_score, vul_score), "
"0","            ~ range_wna(scale(.))) %>% "
"0","  mutate(conflict_affected = conflict_score * population, "
"0","         pre_ex_vulnerable = vul_score * population) %>% "
"0","  mutate(vul_pop_score = pmax(vul_score, conflict_score, na.rm = TRUE),"
"0","         vul_pop = vul_pop_score * population) %>% "
"0","  group_by(state) %>% "
"0","  mutate(vul_pop_pc = vul_pop / sum(vul_pop, na.rm = TRUE), "
"0","         PIN = vul_pop_pc * insecure_persons + IDPs, "
"0","         pc_pin = PIN / sum(PIN, na.rm = TRUE)) %>% "
"0","  ungroup() %>% "
"0","  mutate(pc_pop = PIN / population) %>% "
"0","  do.call(data.frame, .) %>% "
"0","  as_tibble()"
"0","  "
"0",""
"0","  "
